language: ruby
install: bundle install --path vendor/bundle
cache:
  directories: vendor/bundle
addons:
  hosts:
    - vvv.dev
    - local.wordpress.dev
    - local.wordpress-trunk.dev
    - src.wordpress-develop.dev
    - build.wordpress-develop.dev

before_script:
    - sudo rm -rf ~/.gnupg
    - sudo mkdir /srv/database && sudo mount --bind `pwd`/database /srv/database
    - sudo mkdir /srv/config && sudo mount --bind `pwd`/config /srv/config
    - sudo mkdir /srv/www && sudo mount --bind `pwd`/www /srv/www
    - sudo service mysql restart && echo "USE mysql;\nUPDATE user SET password=PASSWORD('root') WHERE user='root';\nFLUSH PRIVILEGES;\n" | mysql -u root
    - mysql -u root -proot < /srv/database/init.sql
    - sudo bash provision/provision.sh

script: bundle exec rake spec
